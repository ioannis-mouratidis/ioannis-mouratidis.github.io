{{ $item := .item }}
{{ $has_attachments := partial "functions/has_attachments" $item }}

<div class="pub-list-item view-citation" style="margin-bottom: 1rem; position: relative;">
  {{ if or $item.Params.featured $item.Params.corresponding_author }}
  <span class="pub-icon" aria-hidden="true" style="display: none;">
    {{ if $item.Params.featured }}<span style="font-size: 1.8em; line-height: 1; transform: translateY(0.1em); display: inline-block; font-weight: bold;">*</span>{{ end }}{{ if $item.Params.corresponding_author }}<span style="font-size: 1.0em; line-height: 1;">✉</span>{{ end }}
  </span>
  <style>
    @media (min-width: 768px) {
      .pub-list-item .pub-icon {
        display: flex !important;
        align-items: center !important;
        position: absolute !important;
        left: -3rem !important;
        top: 50% !important;
        transform: translateY(-50%) !important;
        line-height: 1 !important;
        gap: 0.2em !important;
      }
    }
  </style>
  {{ else }}
  <i class="far fa-file-alt pub-icon" aria-hidden="true"></i>
  {{ end }}
  {{/* APA Style */}}
  {{ if eq (site.Params.hugoblox.content.citations.style | default "apa") "apa" }}

  <span class="article-metadata li-cite-author" style="text-transform: none;">
    {{ partial "page_metadata_authors" $item }}
  </span>
  ({{- $item.Date.Format "2006" -}}).
  {{ $doi := "" }}
  {{ $link_url := "" }}
  {{ with $item.Params.hugoblox.ids.doi }}{{ $doi = . }}{{ end }}
  {{ with $item.Params.doi }}{{ $doi = . }}{{ end }}
  {{ with $item.Params.external_link }}{{ $link_url = . }}{{ end }}
  {{ range $item.Params.links }}
    {{ if and (not $link_url) .url }}{{ $link_url = .url }}{{ end }}
  {{ end }}
  {{ if $doi }}
    <a href="https://doi.org/{{ $doi }}" class="underline" target="_blank" rel="noopener">{{ $item.Title }}</a>.
  {{ else if $link_url }}
    <a href="{{ $link_url }}" class="underline" target="_blank" rel="noopener">{{ $item.Title }}</a>.
  {{ else }}
    <span class="font-medium">{{ $item.Title }}</span>.
  {{ end }}
  {{ if $item.Params.publication_short }}
    {{- $item.Params.publication_short | markdownify -}}.
  {{ else if $item.Params.publication }}
    {{- $item.Params.publication | markdownify -}}.
  {{ end }}

  {{ if $has_attachments }}
  <div class="flex flex-wrap space-x-3" style="align-items: center;">
    {{ partial "page_links" (dict "page" $item "is_list" 1) }}
    {{ if or $item.Params.featured $item.Params.corresponding_author }}
    <span class="pub-icon-mobile" style="display: flex; align-items: center; line-height: 1; gap: 0.2em; margin-left: 0.5rem;">
      {{ if $item.Params.featured }}<span style="font-size: 1.8em; line-height: 1; transform: translateY(0.1em); display: inline-block; font-weight: bold;">*</span>{{ end }}{{ if $item.Params.corresponding_author }}<span style="font-size: 1.0em; line-height: 1;">✉</span>{{ end }}
    </span>
    <style>
      @media (min-width: 768px) {
        .pub-icon-mobile {
          display: none !important;
        }
      }
    </style>
    {{ end }}
  </div>
  {{ end }}

  {{/* MLA Style */}}
  {{ else }}

  <span class="article-metadata li-cite-author" style="text-transform: none;">
    {{ partial "page_metadata_authors" $item }}.
  </span>
  {{ $doi := "" }}
  {{ $link_url := "" }}
  {{ with $item.Params.hugoblox.ids.doi }}{{ $doi = . }}{{ end }}
  {{ with $item.Params.doi }}{{ $doi = . }}{{ end }}
  {{ with $item.Params.external_link }}{{ $link_url = . }}{{ end }}
  {{ range $item.Params.links }}
    {{ if and (not $link_url) .url }}{{ $link_url = .url }}{{ end }}
  {{ end }}
  {{ if $doi }}
    <a href="https://doi.org/{{ $doi }}" target="_blank" rel="noopener">{{ $item.Title }}</a>.
  {{ else if $link_url }}
    <a href="{{ $link_url }}" target="_blank" rel="noopener">{{ $item.Title }}</a>.
  {{ else }}
    <span class="font-medium">{{ $item.Title }}</span>.
  {{ end }}
  {{ if $item.Params.publication_short }}
    {{- $item.Params.publication_short | markdownify -}},
  {{ else if $item.Params.publication }}
    {{- $item.Params.publication | markdownify -}},
  {{ end }}
  {{- $item.Date.Format "2006" -}}.

  {{ if $has_attachments }}
  <div class="flex flex-wrap space-x-3" style="align-items: center;">
    {{ partial "page_links" (dict "page" $item "is_list" 1) }}
    {{ if or $item.Params.featured $item.Params.corresponding_author }}
    <span class="pub-icon-mobile" style="display: flex; align-items: center; line-height: 1; gap: 0.2em; margin-left: 0.5rem;">
      {{ if $item.Params.featured }}<span style="font-size: 1.8em; line-height: 1; transform: translateY(0.1em); display: inline-block; font-weight: bold;">*</span>{{ end }}{{ if $item.Params.corresponding_author }}<span style="font-size: 1.0em; line-height: 1;">✉</span>{{ end }}
    </span>
    <style>
      @media (min-width: 768px) {
        .pub-icon-mobile {
          display: none !important;
        }
      }
    </style>
    {{ end }}
  </div>
  {{ end }}

  {{ end }}
</div>
